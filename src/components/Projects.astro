---
// src/components/Projects.astro

const projectCategories = [
  {
    id: "climbing",
    title: "Climbing Robots",
    subtitle: "Steel Structure Inspection",
    coverVideo: "/portfolio/CB_robot.mp4", 
    icon: "üßó‚Äç‚ôÇÔ∏è",
    subProjects: [
      {
        id: "ironman",
        name: "IronMan Climbing Robot",
        tagline: "Bicycle-Style Magnetic NDT Inspector",
        description: "A static-wheelbase magnetic climbing robot engineered for non-destructive testing (NDT) of steel structures. Capable of traversing flanges >45mm in gravity-opposing orientations, the system features a custom probe deployment mechanism and a pump-pressurized couplant delivery system to facilitate ultrasonic inspections using an Elcometer MTG8BDL.",       
        media: "/portfolio/IronMan.mp4", 
        github: null,
        youtube: "https://youtu.be/ap3aAc9zmO4?si=CqsCP1pg3CBCu_yu",
        impact: [
                "100m Telemetry Range (ESP-NOW)",
                "Automated Couplant & Probe Deployment",
                "Custom Miniaturized ESP32 Architecture",
                "FEA Validated Chassis (Von Mises)"
                ],
        tech: ["ESP-IDF", "Orange Pi Zero 2W", ".NET & Python", "SolidWorks", "EasyEDA Pro"]
      },
      {
        id: "spidey",
        name: "Spidey Climbing Robot",
        tagline: "Miniaturized Bicycle-Style Inspection Robot",
        description: "A compact evolution of the Ironman architecture, this bicycle-style magnetic climber is engineered for constrained structural inspection. It retains full NDT integration while reducing the physical footprint to traverse steel flanges as narrow as 25mm in gravity-opposing orientations.",        
        media: "/portfolio/SpideyA.mp4",
        github: null,
        youtube: "https://youtu.be/ap3aAc9zmO4?si=CqsCP1pg3CBCu_yu",
        impact: [
          "100m Telemetry Range (ESP-NOW)",
          "Automated Couplant & Probe Deployment",
          "Custom Miniaturized ESP32 Architecture",
          "FEA Validated Chassis (Von Mises)"
        ],
        tech: ["ESP-IDF", "Orange Pi Zero 2W", ".NET & Python", "SolidWorks", "EasyEDA Pro"]
      },
      {
       id: "morpho",
        name: "Morpho Climber",
        tagline: "Advanced Control Magnetic Climber (R&D)",
        description: "A high-precision magnetic climbing robot currently under development, utilizing Active Disturbance Rejection Control (ADRC) and torque optimization to govern adhesion physics. Engineered for extreme geometric constraints, the system is designed to traverse steel flanges narrower than 10mm in any spatial orientation, including inverted surfaces.",        
        media: "/portfolio/Morpho.mp4",
        github: null, 
        youtube: null,
        impact: [
          "Sub-10mm Flange Traversal",
          "MIMO-ADRC Stability Formulation",
          "Gravity-Independent Maneuverability"
        ],
        tech: ["Active Disturbance Rejection Control", "Convex Optimization", "Euler-Lagrange Dynamics", "Embedded C++"]      }
    ]
  },
  {
    id: "aerial",
    title: "Aerial Robots",
    subtitle: "UAVs & Flight Control",
    coverVideo: "/portfolio/Cube.mp4",
    icon: "üöÅ",
    subProjects: [
      {
        id: "fc",
        name: "Custom Flight Controller",
        tagline: "Hardware & Firmware from Scratch",
        description: "Designed and manufactured a custom Flight Controller PCB based on STM32 Blue Pill. Wrote the attitude estimation (EKF) and PID control loops from scratch.",
        media: "/portfolio/fc_test.mp4",
        github: null,
        youtube: null,
        impact: ["250Hz Loop Frequency", "< 2 deg Drift", "Custom PCB"],
        tech: ["Altium Designer", "Embedded C++", "EKF Design"]
      },
      {
        id: "cube",
        name: "Cube Drone",
        tagline: "All-Terrain Multi-Modal Inspection UAV",
        description: "A 10-rotor hybrid platform engineered for civil infrastructure inspection across all physical domains. The system features a CNC-machined Cast Nylon and Carbon Fiber frame capable of aerial flight, terrestrial roving, aquatic maneuvering, and static adhesion to walls or ceilings. It utilizes a Cube Orange controller with a custom fork of ArduCopter firmware to handle specialized climbing and contact-based NDT flight modes.",      
        media: "/portfolio/CubeC.mp4",
        github: null,
        youtube: null,
        impact: ["Multi-Modal (Air/Land/Water)", "Custom ArduPilot Fork", "CNC Frame"],
        tech: ["ArduCopter", "Cube Orange", "CNC Machining"]
      }
    ]
  },
  {
    id: "mobile",
    title: "Mobile Robots",
    subtitle: "UGVs & Navigation",
    coverVideo: "/portfolio/Culvert.mp4",
    icon: "üöó",
    subProjects: [
      {
        id: "culvert",
        name: "Culvert Inspector",
        tagline: "Autonomous Assessment UGV",
        description: "Specialized UGV for NDT of concrete culverts via electro-resistivity sensing. Employs POMDP for autonomous navigation in GPS-denied environments.",
        media: "/portfolio/Culvert.mp4",
        github: null,
        youtube: "https://youtu.be/5Cc-_ZGTyGs?si=d2cpW9iEcHVzIQ6f",
        impact: ["Autonomous Decision Making", "Resistivity Profiling", "Sensor Fusion"],
        tech: ["Ouster 128 LiDAR", "POMDP Algorithm", "Jetson Nano"]
      },
      {
        id: "docbot",
        name: "CarryO Bot",
        tagline: "Autonomous Intra-Logistics Courier",
        description: "Autonomous indoor mobile robot (AMR) for secure document transport. Uses a heterogeneous stack (Jetson + Teensy) for SLAM and real-time control.",
        media: "/portfolio/Docbot.mp4",
        github: "https://github.com/pratik7229/office_robot",
        youtube: "https://youtube.com/shorts/S7ZSq7Eqfz8",
        impact: ["Graph-Based 2D SLAM", "Heterogeneous Compute", "Trajectory Opt."],
        tech: ["ROS Navigation", "Google Cartographer", "Teensy 4.0"]
      }
    ]
  },
  {
    id: "ai",
    title: "AI & Deep Learning",
    subtitle: "Perception Systems",
    coverVideo: "/ai.mp4",
    icon: "üß†",
    subProjects: [
      {
    id: "gesture-blur",
    name: "Image Blurring Using Hand Gesture",
    tagline: "Real-Time Adaptive Optics",
    description: "A computer vision interface that dynamically adjusts optical blur based on hand geometry using MediaPipe. It calculates the distance between the thumb and index finger to control the blurriness level of the camera feed in real-time.",
    media: null,
    github: "https://github.com/pratik7229/Deep-Learning_projects/tree/main/Image_Bluring_Using_Hand_Gesture",
    youtube: null,
    impact: [
      "Touchless Interface",
      "Dynamic Depth Control",
      "Interactive CV Application"
    ],
    tech: [
      "MediaPipe",
      "OpenCV",
      "Python",
      "NumPy"
    ]
      },
      {
        id: "finger-counter",
        name: "Finger Counter",
        tagline: "Gestural Input Foundation",
        description: "A fundamental computer vision project that implements contour analysis to count fingers raised in a video feed. It serves as a baseline for complex hand-tracking systems.",
        media: "/portfolio/finger_counter.mp4",
        github: "https://github.com/pratik7229/Deep-Learning_projects/tree/main/Fingure_Counter_Using_Computer_Vision",
        youtube: null,
        impact: [
          "Contour Analysis",
        "Gesture Recognition Basics",
        "Real-Time Processing"
        ],
    tech: [
      "OpenCV",
      "Python",
      "NumPy"
    ]
      },
      {
        id: "license-plate-ocr",
        name: "License Plate Recognition",
        tagline: "Automated Vehicle Identification",
        description: "An optical character recognition system utilizing EasyOCR to extract license plate numbers from both static images and video streams. Designed for efficiency in automated data extraction tasks.",
        media: "/portfolio/license_plate.mp4",
        github: "https://github.com/pratik7229/Deep-Learning_projects/tree/main/License_Plate_Recognition",
        youtube: null,
        impact: [
      "Automated OCR",
      "Stream & Static Support",
      "High Accuracy Text Extraction"
    ],
    tech: [
      "EasyOCR",
      "OpenCV",
      "Python"
    ]
  },
  {
    id: "nn-scratch",
    name: "Neural Network From Scratch",
    tagline: "Bare-Metal Deep Learning",
    description: "A foundational deep learning implementation built without high-level libraries like TensorFlow. It reconstructs backpropagation and model training steps using pure linear algebra to demonstrate core principles.",
    media: "/portfolio/nn_scratch.mp4",
    github: "https://github.com/pratik7229/Deep-Learning_projects/tree/main/neural_network_from_scratch",
    youtube: null,
    impact: [
      "Mathematical First Principles",
      "No Framework Dependencies",
      "Algorithmic Transparency"
    ],
    tech: [
      "Linear Algebra",
      "Calculus",
      "NumPy",
      "Python"
    ]
  },
  {
    id: "virtual-gym-assistant",
    name: "Virtual Gym Assistant",
    tagline: "AI-Powered Fitness Tracker",
    description: "A fitness monitoring application that harnesses MediaPipe to detect body landmarks. It specifically tracks bicep curl repetitions in real-time to assist users in maintaining exercise form.",
    media: "/portfolio/gym_assistant.mp4",
    github: "https://github.com/pratik7229/Deep-Learning_projects/tree/main/Virtual_Gym_Assistant",
    youtube: null,
    impact: [
      "Pose Estimation",
      "Automated Activity Tracking",
      "Health Tech Integration"
    ],
    tech: [
      "MediaPipe",
      "Computer Vision",
      "Python"
    ]
  }

    ]
  }
];
---

<section id="projects" class="projects-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Robotics & AI Projects</h2>
      <p class="section-subtitle">A collection of autonomous systems, NDT solutions, and perception algorithms.</p>
      <div class="title-line"></div>
    </div>

    <div class="cards-grid" id="mainGrid">
      {projectCategories.map((category) => (
        <div class="category-card" data-category={category.id}>
          <div class="video-wrapper">
            <video 
              autoplay 
              muted 
              loop 
              playsinline 
              class="card-video"
              poster="/portfolio/erdc .png" 
            >
              <source src={category.coverVideo} type="video/mp4" />
            </video>
            <div class="video-overlay"></div>
          </div>
          <div class="card-content">
            <div class="card-icon">{category.icon}</div>
            <h3>{category.title}</h3>
            <p>{category.subtitle}</p>
            <span class="explore-btn">Explore Projects &rarr;</span>
          </div>
        </div>
      ))}
    </div>

    <div class="project-modal" id="projectModal">
      <div class="modal-backdrop"></div> 
      
      <button class="close-modal-btn" aria-label="Close details">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      
      <div class="modal-content">
        
        <div class="modal-bg-wrapper">
           <video id="modalBgVideo" loop muted playsinline class="modal-bg-video"></video>
           <div class="modal-bg-gradient"></div>
        </div>

        <div class="modal-sidebar">
          <div class="sidebar-header">
            <h2 id="modalTitle">Category</h2>
          </div>
          <div class="sub-project-list" id="subProjectList">
            </div>
        </div>

        <div class="modal-details">
          <div class="detail-header">
            <h3 id="detailName">Project Name</h3>
            <span class="detail-tagline" id="detailTagline">Tagline</span>
          </div>
          
          <div class="detail-body">
            
            <div class="action-buttons" id="actionButtons">
                </div>

            <p id="detailDesc">Description goes here...</p>
            
            <div class="tech-section" id="detailTechContainer">
               <h4>Technical Arsenal</h4>
               <div class="tech-tags" id="detailTech"></div>
            </div>

            <div class="impact-section">
                <h4>Key Achievements</h4>
                <div class="impact-grid" id="impactGrid"></div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<script define:vars={{ projectCategories }}>
  window.projectData = projectCategories;
</script>

<style>
  /* --- LAYOUT --- */
  .projects-section {
    padding: 6rem 0;
    background: #0f1117;
    position: relative;
    min-height: 100vh;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .section-header { text-align: center; margin-bottom: 4rem; }
  .section-title {
    font-size: 3rem;
    font-weight: 700;
    background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .section-subtitle { color: #94a3b8; margin-top: 1rem; }
  .title-line {
    width: 80px;
    height: 4px;
    background: #3b82f6;
    margin: 1.5rem auto;
    border-radius: 2px;
  }

  /* --- GRID --- */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .category-card {
    position: relative;
    height: 450px;
    border-radius: 1.5rem;
    overflow: hidden;
    cursor: pointer;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.4s ease;
  }
  .category-card:hover {
    transform: translateY(-10px);
    border-color: #3b82f6;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
  }

  /* Video on Main Cards */
  .video-wrapper {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
  }
  .card-video {
    width: 100%; height: 100%; object-fit: cover;
    filter: brightness(0.6) grayscale(0.4); 
    transition: filter 0.5s ease, transform 6s ease;
  }
  .category-card:hover .card-video {
    filter: brightness(0.9) grayscale(0);
    transform: scale(1.1);
  }
  .video-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(to top, rgba(15, 17, 23, 1) 0%, rgba(15, 17, 23, 0.2) 100%);
  }

  /* Card Content */
  .card-content {
    position: relative; z-index: 2; height: 100%;
    display: flex; flex-direction: column; justify-content: flex-end; padding: 2rem;
  }
  .card-icon {
    font-size: 3rem; margin-bottom: 1rem;
    transform: translateY(20px); opacity: 0; transition: all 0.4s ease;
  }
  .category-card:hover .card-icon { transform: translateY(0); opacity: 1; }
  .card-content h3 { font-size: 2rem; color: white; margin: 0; font-weight: 700; }
  .card-content p { color: #cbd5e1; font-size: 1rem; margin-top: 0.5rem; }
  .explore-btn {
    margin-top: 1.5rem; color: #3b82f6; font-weight: 600;
    opacity: 0; transform: translateX(-20px); transition: all 0.4s ease;
  }
  .category-card:hover .explore-btn { opacity: 1; transform: translateX(0); }

  /* --- MODAL --- */
  .project-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    display: flex; align-items: center; justify-content: center;
  }
  .project-modal.active { opacity: 1; pointer-events: all; }
  
  .modal-backdrop {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    z-index: 1;
  }

  .close-modal-btn {
    position: absolute; top: 2rem; right: 2rem; z-index: 10;
    background: rgba(255, 255, 255, 0.1); border: none; color: white;
    width: 50px; height: 50px; border-radius: 50%; cursor: pointer;
    display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;
  }
  .close-modal-btn:hover { background: #ef4444; transform: rotate(90deg); }

  .modal-content {
    position: relative; z-index: 2;
    width: 90%; max-width: 1200px; height: 85vh;
    background: #151726; border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1.5rem; display: grid; grid-template-columns: 300px 1fr;
    overflow: hidden; box-shadow: 0 50px 100px rgba(0,0,0,0.5);
  }

  /* --- MODAL BACKGROUND VIDEO (UPDATED) --- */
  .modal-bg-wrapper {
    position: absolute;
    top: 0; right: 0; bottom: 0;
    width: 80%; /* CHANGED: Now covers 80% of the modal width from the right */
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .modal-bg-video {
    width: 100%; height: 100%; object-fit: cover;
    opacity: 0.8; 
    filter: brightness(1.0); 
    transition: opacity 0.5s ease-in-out; 
  }

  .modal-bg-gradient {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    /* CHANGED: Gradient logic to merge the 80% video into the 20% background */
    /* Starts solid dark on the left edge of the video wrapper, fades to transparent */
    background: linear-gradient(to right, 
      #151726 0%,              /* Seamless blend with sidebar */
      #151726 10%,             /* Solid buffer */
      rgba(21, 23, 38, 0.8) 30%, /* Aggressive fade start */
      rgba(21, 23, 38, 0.2) 100% /* Transparent end */
    );
  }

  /* SIDEBAR */
  .modal-sidebar {
    background: rgba(0, 0, 0, 0.3); padding: 2rem;
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    display: flex; flex-direction: column;
    position: relative; z-index: 2;
  }
  .sidebar-header h2 {
    color: white; font-size: 1.5rem; margin-bottom: 2rem;
    padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .sub-project-list {
    flex: 1; display: flex; flex-direction: column; gap: 0.8rem; overflow-y: auto;
  }

  .sub-proj-btn {
    background: transparent; border: 1px solid rgba(255, 255, 255, 0.05);
    padding: 1rem; text-align: left; color: #94a3b8; border-radius: 0.75rem;
    cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
  }
  .sub-proj-btn:hover {
    background: rgba(255, 255, 255, 0.08); color: white; transform: translateX(5px);
  }
  .sub-proj-btn.active {
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.1) 100%);
    border-color: #3b82f6; color: white; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
  }
  .sub-proj-btn.active::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: #3b82f6;
  }
  .sub-proj-name { display: block; font-weight: 700; font-size: 1rem; }
  .sub-proj-tag { font-size: 0.75rem; opacity: 0.7; }

  /* DETAILS AREA */
  .modal-details { 
    padding: 3rem; 
    overflow-y: auto; 
    position: relative; z-index: 2;
    background: transparent;
  }
  
  .detail-header { margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem; }
  .detail-header h3 { font-size: 2.5rem; color: white; margin-bottom: 0.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
  .detail-tagline { font-size: 1.2rem; color: #60a5fa; font-family: monospace; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
  
  .action-buttons {
    display: flex; gap: 1rem; margin-bottom: 2rem;
  }
  .btn-link {
    display: inline-flex; align-items: center; gap: 0.5rem;
    padding: 0.6rem 1.2rem; border-radius: 6px;
    font-size: 0.9rem; font-weight: 600; text-decoration: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .btn-link:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
  
  .btn-github { background: #24292e; color: white; border: 1px solid rgba(255,255,255,0.2); }
  .btn-youtube { background: #ef4444; color: white; }
  .btn-github:hover { background: #000; }
  .btn-youtube:hover { background: #dc2626; }

  .detail-body p { color: #f1f5f9; font-size: 1.1rem; line-height: 1.7; margin-bottom: 2.5rem; max-width: 90%; text-shadow: 0 1px 3px rgba(0,0,0,0.9); }

  /* Tech Stack */
  .tech-section h4, .impact-section h4 { 
    color: #cbd5e1; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; text-shadow: 0 1px 2px rgba(0,0,0,0.8);
  }
  .tech-tags { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 3rem; }
  .detail-tech-item {
    background: rgba(16, 185, 129, 0.15); color: #6ee7b7; padding: 0.5rem 1rem;
    border-radius: 4px; font-size: 0.85rem; border: 1px solid rgba(16, 185, 129, 0.3);
    font-weight: 500;
    backdrop-filter: blur(10px);
  }

  /* Impact Grid */
  .impact-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 3rem;
  }
  .impact-card {
    background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15);
    padding: 1rem; border-radius: 0.75rem; display: flex; align-items: center; gap: 0.75rem;
    backdrop-filter: blur(10px);
  }
  .impact-icon { color: #f59e0b; font-size: 1.2rem; }
  .impact-text { color: #f8fafc; font-weight: 600; font-size: 0.95rem; }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    .modal-content { grid-template-columns: 1fr; grid-template-rows: auto 1fr; height: 95vh; }
    .modal-sidebar { border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 1rem; max-height: 25vh; }
    .modal-details { padding: 1.5rem; }
    .section-title { font-size: 2rem; }
    .modal-bg-wrapper { display: none; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.category-card');
    const modal = document.getElementById('projectModal');
    const backdrop = document.querySelector('.modal-backdrop');
    const closeModalBtn = document.querySelector('.close-modal-btn');
    
    const modalTitle = document.getElementById('modalTitle');
    const subProjectList = document.getElementById('subProjectList');
    const modalBgVideo = document.getElementById('modalBgVideo');
    
    const detailName = document.getElementById('detailName');
    const detailTagline = document.getElementById('detailTagline');
    const detailDesc = document.getElementById('detailDesc');
    const detailTech = document.getElementById('detailTech');
    const impactGrid = document.getElementById('impactGrid');
    const actionButtons = document.getElementById('actionButtons');
    
    const data = window.projectData;

    function openModal(categoryId) {
      const category = data.find(c => c.id === categoryId);
      if(!category) return;

      modalTitle.textContent = category.title;
      subProjectList.innerHTML = '';

      category.subProjects.forEach((sub, index) => {
        const btn = document.createElement('button');
        btn.className = `sub-proj-btn ${index === 0 ? 'active' : ''}`;
        btn.innerHTML = `
          <span class="sub-proj-name">${sub.name}</span>
          <span class="sub-proj-tag">${sub.tagline}</span>
        `;
        btn.onclick = () => loadSubProject(sub, btn);
        subProjectList.appendChild(btn);
      });

      loadSubProject(category.subProjects[0]);

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function loadSubProject(sub, activeBtn) {
      if(activeBtn) {
        document.querySelectorAll('.sub-proj-btn').forEach(b => b.classList.remove('active'));
        activeBtn.classList.add('active');
      }

      const detailBody = document.querySelector('.detail-body');
      detailBody.style.opacity = '0';
      detailBody.style.transform = 'translateY(10px)';
      
      if (modalBgVideo) {
          modalBgVideo.style.opacity = '0'; 
          setTimeout(() => {
              if (sub.media) {
                  modalBgVideo.src = sub.media;
                  modalBgVideo.play();
              }
              modalBgVideo.style.opacity = '0.8'; 
          }, 400); 
      }

      setTimeout(() => {
        detailName.textContent = sub.name;
        detailTagline.textContent = sub.tagline;
        detailDesc.textContent = sub.description;
        
        actionButtons.innerHTML = '';
        if (sub.github) {
            const ghBtn = document.createElement('a');
            ghBtn.href = sub.github;
            ghBtn.target = "_blank";
            ghBtn.className = "btn-link btn-github";
            ghBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg> Source Code`;
            actionButtons.appendChild(ghBtn);
        }
        if (sub.youtube) {
            const ytBtn = document.createElement('a');
            ytBtn.href = sub.youtube;
            ytBtn.target = "_blank";
            ytBtn.className = "btn-link btn-youtube";
            ytBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg> Watch Demo`;
            actionButtons.appendChild(ytBtn);
        }
        
        detailTech.innerHTML = '';
        sub.tech.forEach(t => {
          const span = document.createElement('span');
          span.className = 'detail-tech-item';
          span.textContent = t;
          detailTech.appendChild(span);
        });

        impactGrid.innerHTML = '';
        if(sub.impact) {
             sub.impact.forEach(imp => {
                const div = document.createElement('div');
                div.className = 'impact-card';
                div.innerHTML = `<span class="impact-icon">‚ö°</span><span class="impact-text">${imp}</span>`;
                impactGrid.appendChild(div);
             });
        }

        detailBody.style.opacity = '1';
        detailBody.style.transform = 'translateY(0)';
      }, 200);
    }

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      if (modalBgVideo) modalBgVideo.pause();
    }

    cards.forEach(card => {
      card.addEventListener('click', () => {
        const catId = card.getAttribute('data-category');
        openModal(catId);
      });
    });

    backdrop.addEventListener('click', closeModal);
    closeModalBtn.addEventListener('click', closeModal);

    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  });
</script>